import{c as W}from"./chunk-G5WZ53OM.js";import{a as $}from"./chunk-6JFPCEKG.js";import{A as c,C as g,D as I,H as M,J as P,L as y,M as n,N as s,O as h,P as G,Q as p,S as T,T as w,U as O,V as l,W as _,X as S,aa as k,c as L,h as m,ka as H,oa as A,p as u,q as v,qa as Z,r as d,s as f,sa as D,ua as R,z as b}from"./chunk-XOMAETA3.js";var j=["gameCanvas"],F=()=>[];function z(E,i){E&1&&h(0,"div",28)}var V=class E{constructor(i,t,e,r){this.gameService=i;this.settingsService=t;this.router=e;this.route=r}gameCanvas;ctx;CELL_SIZE=20;GAME_WIDTH=20*this.CELL_SIZE;GAME_HEIGHT=30*this.CELL_SIZE;gameState=null;currentTheme;destroyed$=new L;isPaused=!1;isGameOver=!1;score=0;lives=3;level=1;isLevelTransitioning=!1;ngOnInit(){let i=this.gameCanvas.nativeElement;i.width=this.GAME_WIDTH,i.height=this.GAME_HEIGHT,this.ctx=i.getContext("2d"),this.gameService.gameState$.pipe(m(this.destroyed$)).subscribe(t=>{this.gameState=t,t&&(this.isPaused=t.paused,this.isGameOver=t.gameOver,this.score=t.player.score,this.lives=t.player.lives,this.level=t.level.id,this.renderGame())}),this.gameService.currentTheme$.pipe(m(this.destroyed$)).subscribe(t=>{this.currentTheme=t}),this.gameService.gameOver$.pipe(m(this.destroyed$)).subscribe(t=>{this.isGameOver=!0}),this.gameService.levelCompleted$.pipe(m(this.destroyed$)).subscribe(t=>{this.isLevelTransitioning||(this.isLevelTransitioning=!0,console.log(`Level ${t} completed! Transitioning to level ${t+1}`),this.drawLevelCompletedOverlay(),setTimeout(()=>{this.isLevelTransitioning=!1;let e=t+1;console.log(`Starting next level: ${e}`),this.router.navigate(["/game",e])},2e3))}),this.route.paramMap.subscribe(t=>{let e=parseInt(t.get("levelId")||"1",10);console.log(`Starting game with level from route params: ${e}`),this.gameService.startGame(e)})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}handleKeyboardEvent(i){if(i.key==="Escape"){this.togglePause();return}this.gameService.handleKeyPress(i)}togglePause(){this.gameService.pauseGame()}restartGame(){this.gameService.restartGame()}goToMainMenu(){this.router.navigate(["/menu"])}renderGame(){!this.gameState||!this.ctx||(this.ctx.fillStyle=this.currentTheme.backgroundColor,this.ctx.fillRect(0,0,this.GAME_WIDTH,this.GAME_HEIGHT),this.drawMaze(),this.drawPlayer(),this.drawGhosts(),this.drawUI(),this.isPaused?this.drawPauseOverlay():this.isGameOver&&this.drawGameOverOverlay())}drawMaze(){if(!this.gameState)return;let i=this.gameState.level.grid;for(let t=0;t<i.length;t++)for(let e=0;e<i[t].length;e++){let r=i[t][e],a=e*this.CELL_SIZE,o=t*this.CELL_SIZE;switch(r){case 1:this.ctx.fillStyle=this.currentTheme.wallColor,this.ctx.fillRect(a,o,this.CELL_SIZE,this.CELL_SIZE);break;case 2:this.ctx.fillStyle=this.currentTheme.dotColor,this.ctx.beginPath(),this.ctx.arc(a+this.CELL_SIZE/2,o+this.CELL_SIZE/2,this.CELL_SIZE/10,0,Math.PI*2),this.ctx.fill();break;case 3:this.ctx.fillStyle=this.currentTheme.powerPelletColor,this.ctx.beginPath(),this.ctx.arc(a+this.CELL_SIZE/2,o+this.CELL_SIZE/2,this.CELL_SIZE/4,0,Math.PI*2),this.ctx.fill();break}}}drawPlayer(){if(!this.gameState)return;let i=this.gameState.player,t=i.position.x*this.CELL_SIZE+this.CELL_SIZE/2,e=i.position.y*this.CELL_SIZE+this.CELL_SIZE/2,r=this.CELL_SIZE/2;this.ctx.fillStyle=this.currentTheme.playerColor,this.ctx.beginPath();let a=.2*Math.PI,o=1.8*Math.PI;switch(i.direction){case 1:a=.2*Math.PI,o=1.8*Math.PI;break;case 2:a=.7*Math.PI,o=2.3*Math.PI;break;case 3:a=1.2*Math.PI,o=.8*Math.PI;break;case 0:a=1.7*Math.PI,o=1.3*Math.PI;break}this.ctx.arc(t,e,r*.8,a,o),this.ctx.lineTo(t,e),this.ctx.closePath(),this.ctx.fill()}drawGhosts(){this.gameState&&this.gameState.ghosts.forEach(i=>{let t=i.position.x*this.CELL_SIZE,e=i.position.y*this.CELL_SIZE,r;i.state===1?r=this.currentTheme.frightenedGhostColor:i.state===2?r="#ffffff":r=this.currentTheme.ghostColors[i.type],this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(t+this.CELL_SIZE/2,e+this.CELL_SIZE/2,this.CELL_SIZE/2,Math.PI,0),this.ctx.lineTo(t+this.CELL_SIZE,e+this.CELL_SIZE);for(let x=0;x<3;x++){let C=t+this.CELL_SIZE-x*this.CELL_SIZE/3;this.ctx.lineTo(C,e+this.CELL_SIZE-this.CELL_SIZE/4),this.ctx.lineTo(C-this.CELL_SIZE/6,e+this.CELL_SIZE)}this.ctx.lineTo(t,e+this.CELL_SIZE/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.beginPath(),this.ctx.arc(t+this.CELL_SIZE/3,e+this.CELL_SIZE/2,this.CELL_SIZE/6,0,Math.PI*2),this.ctx.arc(t+this.CELL_SIZE*2/3,e+this.CELL_SIZE/2,this.CELL_SIZE/6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000000";let a=0,o=0;switch(i.direction){case 0:o=-this.CELL_SIZE/12;break;case 1:a=this.CELL_SIZE/12;break;case 2:o=this.CELL_SIZE/12;break;case 3:a=-this.CELL_SIZE/12;break}this.ctx.beginPath(),this.ctx.arc(t+this.CELL_SIZE/3+a,e+this.CELL_SIZE/2+o,this.CELL_SIZE/10,0,Math.PI*2),this.ctx.arc(t+this.CELL_SIZE*2/3+a,e+this.CELL_SIZE/2+o,this.CELL_SIZE/10,0,Math.PI*2),this.ctx.fill()})}drawUI(){}drawPauseOverlay(){this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.GAME_WIDTH,this.GAME_HEIGHT),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.fillText("PAUSED",this.GAME_WIDTH/2,this.GAME_HEIGHT/2),this.ctx.font="16px Arial",this.ctx.fillText("Press ESC to resume",this.GAME_WIDTH/2,this.GAME_HEIGHT/2+30)}drawGameOverOverlay(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.GAME_WIDTH,this.GAME_HEIGHT),this.ctx.fillStyle="#ff0000",this.ctx.font="bold 28px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.GAME_WIDTH/2,this.GAME_HEIGHT/2-20),this.ctx.fillStyle="#ffffff",this.ctx.font="20px Arial",this.ctx.fillText(`Final Score: ${this.score}`,this.GAME_WIDTH/2,this.GAME_HEIGHT/2+20),this.ctx.font="16px Arial",this.ctx.fillText("Click to restart",this.GAME_WIDTH/2,this.GAME_HEIGHT/2+60)}drawLevelCompletedOverlay(){this.ctx&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.GAME_WIDTH,this.GAME_HEIGHT),this.ctx.fillStyle="#00ff00",this.ctx.font="bold 28px Arial",this.ctx.textAlign="center",this.ctx.fillText("LEVEL COMPLETED!",this.GAME_WIDTH/2,this.GAME_HEIGHT/2-20),this.ctx.fillStyle="#ffffff",this.ctx.font="20px Arial",this.ctx.fillText(`Score: ${this.score}`,this.GAME_WIDTH/2,this.GAME_HEIGHT/2+20),this.ctx.font="16px Arial",this.ctx.fillText("Loading next level...",this.GAME_WIDTH/2,this.GAME_HEIGHT/2+60))}static \u0275fac=function(t){return new(t||E)(g(W),g($),g(D),g(Z))};static \u0275cmp=I({type:E,selectors:[["app-game"]],viewQuery:function(t,e){if(t&1&&T(j,7),t&2){let r;w(r=O())&&(e.gameCanvas=r.first)}},hostBindings:function(t,e){t&1&&p("keydown",function(a){return e.handleKeyboardEvent(a)},!1,b)},decls:47,vars:8,consts:[["gameCanvas",""],[1,"game-container"],[1,"game-content"],[1,"game-header"],[1,"game-stats"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value","neon-text"],[1,"stat-value"],["class","life-dot",4,"ngFor","ngForOf"],[1,"game-status"],[1,"game-canvas-container"],[1,"game-canvas"],[1,"mobile-controls"],["aria-label","Up",1,"control-btn","up-btn"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"control-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 15l7-7 7 7"],["aria-label","Left",1,"control-btn","left-btn"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["aria-label","Down",1,"control-btn","down-btn"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["aria-label","Right",1,"control-btn","right-btn"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"game-controls"],[1,"game-btn",3,"click"],[1,"game-btn","restart-btn",3,"click"],[1,"game-btn","menu-btn",3,"click"],[1,"game-instructions"],[1,"life-dot"]],template:function(t,e){if(t&1){let r=G();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"span",6),l(6,"SCORE"),s(),n(7,"div",7),l(8),s()(),n(9,"div",5)(10,"span",6),l(11,"LEVEL"),s(),n(12,"div",7),l(13),s()(),n(14,"div",5)(15,"span",6),l(16,"LIVES"),s(),n(17,"div",8),M(18,z,1,0,"div",9),s()()(),n(19,"div",10),l(20),s()(),n(21,"div",11),h(22,"canvas",12,0),n(24,"div",13)(25,"button",14),d(),n(26,"svg",15),h(27,"path",16),s()(),f(),n(28,"button",17),d(),n(29,"svg",15),h(30,"path",18),s()(),f(),n(31,"button",19),d(),n(32,"svg",15),h(33,"path",20),s()(),f(),n(34,"button",21),d(),n(35,"svg",15),h(36,"path",22),s()()()(),f(),n(37,"div",23)(38,"button",24),p("click",function(){return u(r),v(e.togglePause())}),l(39),s(),n(40,"button",25),p("click",function(){return u(r),v(e.restartGame())}),l(41," Restart "),s(),n(42,"button",26),p("click",function(){return u(r),v(e.goToMainMenu())}),l(43," Main Menu "),s()(),n(44,"div",27)(45,"p"),l(46,"Use arrow keys to move \u2022 Press ESC to pause"),s()()()()}t&2&&(c(8),_(e.score),c(5),_(e.level),c(5),P("ngForOf",k(7,F).constructor(e.lives)),c(),y("paused",e.isPaused),c(),S(" ",e.isPaused?"PAUSED":"PLAYING"," "),c(19),S(" ",e.isPaused?"Resume":"Pause"," "))},dependencies:[A,H,R],styles:['.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:20px auto;max-width:800px}.game-canvas[_ngcontent-%COMP%]{width:100%;max-width:600px;image-rendering:pixelated}.game-controls[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;background-color:#2121ff;color:#fff;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#3a3aff}button[_ngcontent-%COMP%]:active{background-color:#00c}.control-btn[_ngcontent-%COMP%]{transition:all .2s}.game-canvas-container[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(#12101000 50%,#0000001a 50%),linear-gradient(90deg,#ff000008,#00ff0005,#0000ff08);background-size:100% 2px,3px 100%;pointer-events:none;z-index:10;border-radius:.5rem}.game-content[_ngcontent-%COMP%]{width:100%;max-width:1000px;margin:0 auto;display:flex;flex-direction:column;align-items:center}.game-header[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.game-stats[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-label[_ngcontent-%COMP%]{font-family:"Press Start 2P",cursive;font-size:.875rem;color:#9ca3af}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem}.stat-value.neon-text[_ngcontent-%COMP%]{color:#ff0;text-shadow:0 0 5px #ffff00,0 0 10px #ffff00}.life-dot[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem;border-radius:50%;background-color:#ff0;margin-right:.25rem;display:inline-block}.game-status[_ngcontent-%COMP%]{font-family:"Press Start 2P",cursive;font-size:.875rem;color:#10b981}.game-status.paused[_ngcontent-%COMP%]{color:#fbbf24;animation:_ngcontent-%COMP%_pulse 1s infinite}.game-canvas-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1.5rem}.game-canvas[_ngcontent-%COMP%]{border:4px solid #2121ff;border-radius:.5rem;background-color:#000;box-shadow:0 0 5px #2121ff,0 0 10px #2121ff;width:100%;max-width:600px;image-rendering:pixelated}@media (min-width: 768px){.game-canvas[_ngcontent-%COMP%]{min-height:500px}}.mobile-controls[_ngcontent-%COMP%]{position:absolute;bottom:1rem;left:1rem;display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.control-btn[_ngcontent-%COMP%]{background-color:#1f293780;border-radius:9999px;padding:1rem;transition:all .2s}.up-btn[_ngcontent-%COMP%]{grid-column-start:2}.left-btn[_ngcontent-%COMP%]{grid-column-start:1;grid-row-start:2}.down-btn[_ngcontent-%COMP%]{grid-column-start:2;grid-row-start:2}.right-btn[_ngcontent-%COMP%]{grid-column-start:3;grid-row-start:2}.control-icon[_ngcontent-%COMP%]{height:1.5rem;width:1.5rem}.control-btn[_ngcontent-%COMP%]:active{transform:scale(.9);background-color:#2121ffb3}.game-controls[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}.restart-btn[_ngcontent-%COMP%]{background-color:red}.restart-btn[_ngcontent-%COMP%]:hover{background-color:#b91c1c}.menu-btn[_ngcontent-%COMP%]{background-color:#4b5563}.menu-btn[_ngcontent-%COMP%]:hover{background-color:#6b7280}.game-instructions[_ngcontent-%COMP%]{margin-top:1.5rem;text-align:center;color:#9ca3af;font-size:.875rem}@media (min-width: 768px){.mobile-controls[_ngcontent-%COMP%]{display:none}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}']})};export{V as GameComponent};
