import{c as ge}from"./chunk-G5WZ53OM.js";import{a as he,c as pe,d as ue,f as fe}from"./chunk-CEUQJDXH.js";import{A as p,C as j,D as K,H as S,J as _,K as ee,L as D,M as l,N as o,O as V,P as $,Q as E,R as I,S as q,T as Q,U as B,V as d,W as k,X as w,Y as te,Z as ie,_ as ne,a as N,aa as G,b as Y,ba as L,c as X,ca as ae,d as R,da as T,h as O,j as A,ka as re,la as oe,m as W,ma as se,na as le,oa as ce,p as y,q as C,sa as de,ua as me,w as J}from"./chunk-XOMAETA3.js";var z=class g{weights;inputSize=128;hiddenSizes=[256,256,128];outputSize=4;constructor(){this.weights=this.initializeWeights()}initializeWeights(){let e=[],t=[this.inputSize,...this.hiddenSizes,this.outputSize];for(let i=0;i<t.length-1;i++){let n=t[i],a=t[i+1],r=Math.sqrt(6/(n+a)),c=Array(a).fill(0).map(()=>Array(n).fill(0).map(()=>(Math.random()*2-1)*r)),s=Array(a).fill(0);e.push({weights:c,biases:s})}return{layers:e}}forward(e){let t=[e],i=e;for(let n=0;n<this.weights.layers.length;n++){let a=this.weights.layers[n],r=this.matrixMultiply(i,a.weights,a.biases),c;n<this.weights.layers.length-1?c=r.map(s=>Math.max(0,s)):c=r.map(s=>Math.tanh(s/10)*100),t.push(c),i=c}return{output:i,activations:t}}matrixMultiply(e,t,i){let n=[];for(let a=0;a<t.length;a++){let r=i[a];for(let c=0;c<e.length;c++)!isFinite(e[c])||!isFinite(t[a][c])?(console.warn("Invalid value detected in neural network computation"),r+=0):r+=e[c]*t[a][c];n.push(Math.max(-1e3,Math.min(1e3,r)))}return n}backward(e,t,i=.001){if(!this.validateInputs(e,t))return 0;let{output:n,activations:a}=this.forward(e),r=0;for(let s=0;s<n.length;s++){let h=n[s]-t[s];isFinite(h)&&(r+=h*h)}if(r=r/n.length,!isFinite(r))return console.warn("Invalid loss detected, skipping update"),0;let c=n.map((s,h)=>{let x=2*(s-t[h])/n.length;return Math.max(-10,Math.min(10,x))});for(let s=this.weights.layers.length-1;s>=0;s--){let h=this.weights.layers[s],x=a[s];for(let m=0;m<h.weights.length;m++){for(let f=0;f<h.weights[m].length;f++){let v=c[m]*x[f],b=Math.max(-1,Math.min(1,v)),M=i*b;h.weights[m][f]-=M,h.weights[m][f]=Math.max(-100,Math.min(100,h.weights[m][f])),isFinite(h.weights[m][f])||(console.warn("NaN weight detected, reinitializing"),h.weights[m][f]=(Math.random()*2-1)*.1)}let u=i*c[m];h.biases[m]-=Math.max(-1,Math.min(1,u)),h.biases[m]=Math.max(-100,Math.min(100,h.biases[m])),isFinite(h.biases[m])||(console.warn("NaN bias detected, reinitializing"),h.biases[m]=0)}if(s>0){let m=Array(x.length).fill(0);for(let u=0;u<m.length;u++){for(let f=0;f<c.length;f++)m[u]+=c[f]*h.weights[f][u];x[u]<=0&&(m[u]=0),m[u]=Math.max(-10,Math.min(10,m[u]))}c=m}}return r}predict(e){return this.forward(e).output}clone(){return JSON.parse(JSON.stringify(this.weights))}loadWeights(e){this.weights=JSON.parse(JSON.stringify(e))}saveWeights(){return this.clone()}updateTargetNetwork(e,t=.005){for(let i=0;i<this.weights.layers.length;i++){let n=this.weights.layers[i],a=e.layers[i];for(let r=0;r<n.weights.length;r++)for(let c=0;c<n.weights[r].length;c++)a.weights[r][c]=t*n.weights[r][c]+(1-t)*a.weights[r][c];for(let r=0;r<n.biases.length;r++)a.biases[r]=t*n.biases[r]+(1-t)*a.biases[r]}}validateInputs(e,t){for(let i=0;i<e.length;i++)if(!isFinite(e[i]))return console.warn(`Invalid input at index ${i}: ${e[i]}`),!1;for(let i=0;i<t.length;i++)if(!isFinite(t[i]))return console.warn(`Invalid target at index ${i}: ${t[i]}`),!1;return!0}static \u0275fac=function(t){return new(t||g)};static \u0275prov=A({token:g,factory:g.\u0275fac,providedIn:"root"})};var H=class g{buffer=[];maxSize;currentIndex=0;constructor(){this.maxSize=5e4}add(e){this.buffer.length<this.maxSize?this.buffer.push(e):(this.buffer[this.currentIndex]=e,this.currentIndex=(this.currentIndex+1)%this.maxSize)}sample(e){if(this.buffer.length<e)return[...this.buffer];let t=[],i=new Set;for(;i.size<e;){let n=Math.floor(Math.random()*this.buffer.length);i.has(n)||(i.add(n),t.push(this.buffer[n]))}return t}size(){return this.buffer.length}clear(){this.buffer=[],this.currentIndex=0}samplePrioritized(e,t){if(!t||t.length!==this.buffer.length)return this.sample(e);let i=[],n=t.reduce((a,r)=>a+r,0);for(let a=0;a<e&&a<this.buffer.length;a++){let r=Math.random()*n,c=0;for(let s=0;s<t.length;s++)if(r-=t[s],r<=0){c=s;break}i.push(this.buffer[c])}return i}getLatest(e){let t=Math.max(0,this.buffer.length-e);return this.buffer.slice(t)}setMaxSize(e){this.maxSize=e,this.buffer.length>e&&(this.buffer=this.buffer.slice(-e),this.currentIndex=0)}static \u0275fac=function(t){return new(t||g)};static \u0275prov=A({token:g,factory:g.\u0275fac,providedIn:"root"})};var Z=class g{constructor(e,t,i){this.mainNetwork=e;this.replayBuffer=t;this.ngZone=i;this.targetNetwork=new z,this.targetNetwork.loadWeights(this.mainNetwork.saveWeights())}config={learningRate:5e-5,epsilon:1,epsilonMin:.01,epsilonDecay:.9995,memorySize:5e4,batchSize:16,targetUpdateFrequency:2e3,gamma:.95};currentMode=new R("training");trainingMetrics=new R({episode:0,score:0,epsilon:1,loss:0,averageReward:0,explorationRate:1,gamesPlayed:0,bestScore:0,averageScore:0});visualizationData=new R({qValues:[0,0,0,0],actionProbabilities:[.25,.25,.25,.25],stateValue:0,explorationVsExploitation:"exploration",networkActivations:[]});isTraining=!1;trainingStepCount=0;episodeCount=0;scoreHistory=[];lastState=null;lastAction=null;targetNetwork;get mode$(){return this.currentMode.asObservable()}get trainingMetrics$(){return this.trainingMetrics.asObservable()}get visualizationData$(){return this.visualizationData.asObservable()}setMode(e){this.currentMode.next(e),e==="training"?this.isTraining=!0:this.isTraining=!1}getAction(e){let t=this.convertGameStateToAIState(e),i=this.encodeState(t),n,a;if(this.isTraining&&Math.random()<this.config.epsilon)n=Math.floor(Math.random()*4),a="exploration";else{let{output:r,activations:c}=this.mainNetwork.forward(i);n=this.getBestAction(r),a="exploitation",this.updateVisualizationData(r,c,a)}return this.isTraining&&(this.lastState=t,this.lastAction=n),{direction:n,confidence:a==="exploitation"?.8:.2}}learn(e,t,i){if(!this.isTraining||!this.lastState||this.lastAction===null)return;let n=this.convertGameStateToAIState(e),a={state:this.lastState,action:this.lastAction,reward:t,nextState:n,done:i};this.replayBuffer.add(a),this.replayBuffer.size()>=this.config.batchSize&&this.trainNetwork(),this.trainingStepCount%this.config.targetUpdateFrequency===0&&this.targetNetwork.loadWeights(this.mainNetwork.saveWeights()),this.trainingStepCount++,this.config.epsilon>this.config.epsilonMin&&(this.config.epsilon*=this.config.epsilonDecay),this.updateMetrics(n.score,i)}convertGameStateToAIState(e){return{grid:e.level.grid.map(t=>[...t]),playerPosition:N({},e.player.position),ghostPositions:e.ghosts.map(t=>({x:t.position.x,y:t.position.y,type:t.type,state:t.state})),dotsRemaining:e.level.dotCount-e.dotsEaten,powerPelletActive:e.powerPelletActive,score:e.player.score,lives:e.player.lives}}encodeState(e){let t=[];if(!e||!e.grid||!e.playerPosition||!e.ghostPositions)return console.warn("Invalid AI state detected, using default encoding"),Array(128).fill(0);let i=8,n=e.grid[0].length/i,a=e.grid.length/i;for(let m=0;m<i;m++)for(let u=0;u<i;u++){let f=Math.floor(u*n),v=Math.floor(m*a);if(v>=0&&v<e.grid.length&&f>=0&&f<e.grid[0].length){let b=e.grid[v][f]/5;t.push(isFinite(b)?b:0)}else t.push(0)}let r=isFinite(e.playerPosition.x)?e.playerPosition.x/e.grid[0].length:0,c=isFinite(e.playerPosition.y)?e.playerPosition.y/e.grid.length:0;t.push(Math.max(0,Math.min(1,r))),t.push(Math.max(0,Math.min(1,c)));for(let m=0;m<4;m++)if(m<e.ghostPositions.length){let u=e.ghostPositions[m],f=isFinite(u.x)?u.x/e.grid[0].length:0,v=isFinite(u.y)?u.y/e.grid.length:0,b=isFinite(u.type)?u.type/4:0,M=isFinite(u.state)?u.state/3:0;t.push(Math.max(0,Math.min(1,f))),t.push(Math.max(0,Math.min(1,v))),t.push(Math.max(0,Math.min(1,b))),t.push(Math.max(0,Math.min(1,M)))}else t.push(0,0,0,0);let s=isFinite(e.dotsRemaining)?e.dotsRemaining/100:0,h=isFinite(e.score)?e.score/1e4:0,x=isFinite(e.lives)?e.lives/3:0;for(t.push(Math.max(0,Math.min(1,s))),t.push(e.powerPelletActive?1:0),t.push(Math.max(0,Math.min(1,h))),t.push(Math.max(0,Math.min(1,x)));t.length<128;)t.push(0);return t.slice(0,128)}getBestAction(e){if(!e||e.length===0)return 0;let t=0,i=e[0];for(let n=1;n<e.length;n++)isFinite(e[n])&&e[n]>i&&(i=e[n],t=n);return t}trainNetwork(){let e=this.replayBuffer.sample(this.config.batchSize),t=0;for(let n of e){let a=this.encodeState(n.state),r=this.encodeState(n.nextState),s=[...this.mainNetwork.predict(a)];if(n.done)s[n.action]=n.reward;else{let x=this.targetNetwork.predict(r),m=Math.max(...x);s[n.action]=n.reward+this.config.gamma*m}let h=this.mainNetwork.backward(a,s,this.config.learningRate);t+=h}let i=t/e.length;this.updateLossMetrics(i)}updateVisualizationData(e,t,i){let n=e.map(s=>isFinite(s)?s:0),a;if(i==="exploration")a=[.25,.25,.25,.25];else{let h=n.map(v=>v/1),x=Math.max(...h),m=h.map(v=>{let b=Math.exp(v-x);return isFinite(b)?b:0}),u=m.reduce((v,b)=>v+b,0);u>0&&isFinite(u)?a=m.map(v=>v/u):a=[.25,.25,.25,.25];let f=a.reduce((v,b)=>v+b,0);Math.abs(f-1)>.01&&(a=[.25,.25,.25,.25])}let r=n.length>0?Math.max(...n):0,c={qValues:n,actionProbabilities:a.map(s=>isFinite(s)?Math.max(0,Math.min(1,s)):.25),stateValue:isFinite(r)?r:0,explorationVsExploitation:i,networkActivations:t.map(s=>s.map(h=>isFinite(h)?h:0))};this.visualizationData.next(c)}updateMetrics(e,t){t&&(this.episodeCount++,this.scoreHistory.push(e),this.scoreHistory.length>100&&this.scoreHistory.shift());let i=Math.max(...this.scoreHistory,0),n=this.scoreHistory.length>0?this.scoreHistory.reduce((a,r)=>a+r,0)/this.scoreHistory.length:0;this.trainingMetrics.next({episode:this.episodeCount,score:e,epsilon:this.config.epsilon,loss:this.trainingMetrics.value.loss,averageReward:this.trainingMetrics.value.averageReward,explorationRate:this.config.epsilon,gamesPlayed:this.episodeCount,bestScore:i,averageScore:n})}updateLossMetrics(e){let t=this.trainingMetrics.value;this.trainingMetrics.next(Y(N({},t),{loss:e}))}calculateReward(e,t,i){let n=0;if(!e||!t)return 0;n+=-1;let a=t.dotsEaten-e.dotsEaten;isFinite(a)&&a>0&&(n+=a*10),t.powerPelletActive&&!e.powerPelletActive&&(n+=50);let r=e.ghosts.filter(s=>s.state===2).length;return t.ghosts.filter(s=>s.state===2).length>r&&(n+=200),t.player.lives<e.player.lives&&(n+=-500),t.dotsEaten>=t.level.dotCount&&(n+=1e3),this.isInvalidMove(e,t,i)&&(n+=-10),n=Math.max(-1e3,Math.min(1e3,n)),isFinite(n)?n:0}isInvalidMove(e,t,i){let n=e.player.position,a=t.player.position;if(n.x===a.x&&n.y===a.y){let r=e.level.grid,c=n.x,s=n.y;switch(i){case 0:s--;break;case 1:c++;break;case 2:s++;break;case 3:c--;break}if(s<0||s>=r.length||c<0||c>=r[0].length||r[s][c]===1)return!0}return!1}reset(){this.lastState=null,this.lastAction=null}saveModel(){let e={weights:this.mainNetwork.saveWeights(),config:this.config,metrics:this.trainingMetrics.value};return JSON.stringify(e)}loadModel(e){try{let t=JSON.parse(e);this.mainNetwork.loadWeights(t.weights),this.targetNetwork.loadWeights(t.weights),this.config=N(N({},this.config),t.config),t.metrics&&this.trainingMetrics.next(t.metrics)}catch(t){console.error("Failed to load model:",t)}}static \u0275fac=function(t){return new(t||g)(W(z),W(H),W(J))};static \u0275prov=A({token:g,factory:g.\u0275fac,providedIn:"root"})};var Se=["gameCanvas"],Ee=["networkCanvas"],we=()=>[1,2,5,10],Ie=()=>["UP","RIGHT","DOWN","LEFT"],Pe=()=>["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4"],ke=()=>["\u2191","\u2192","\u2193","\u2190"];function Oe(g,e){if(g&1&&(l(0,"div",44)(1,"span"),d(2),o(),l(3,"span"),d(4),o(),l(5,"span"),d(6),o()()),g&2){let t=I();p(2),w("Score: ",t.gameState.player.score,""),p(2),w("Lives: ",t.gameState.player.lives,""),p(2),w("Level: ",t.gameState.level.id,"")}}function Le(g,e){g&1&&(l(0,"div",45)(1,"div",46),d(2,"Click Start Training to begin"),o()())}function Ae(g,e){if(g&1){let t=$();l(0,"button",47),E("click",function(){let n=y(t).$implicit,a=I();return C(a.setTrainingSpeed(n))}),d(1),o()}if(g&2){let t=e.$implicit,i=I();D("active",i.trainingSpeed===t),p(),w(" ",t,"x ")}}function Te(g,e){if(g&1&&(l(0,"div",48)(1,"div",49)(2,"div",50),d(3,"Episode"),o(),l(4,"div",51),d(5),o()(),l(6,"div",49)(7,"div",50),d(8,"Current Score"),o(),l(9,"div",51),d(10),o()(),l(11,"div",49)(12,"div",50),d(13,"Best Score"),o(),l(14,"div",52),d(15),o()(),l(16,"div",49)(17,"div",50),d(18,"Average Score"),o(),l(19,"div",51),d(20),L(21,"number"),o()(),l(22,"div",49)(23,"div",50),d(24,"Exploration Rate"),o(),l(25,"div",51),d(26),L(27,"number"),o()(),l(28,"div",49)(29,"div",50),d(30,"Training Loss"),o(),l(31,"div",51),d(32),L(33,"number"),o()()()),g&2){let t=I();p(5),k(t.trainingMetrics.episode),p(5),k(t.trainingMetrics.score),p(5),k(t.trainingMetrics.bestScore),p(5),k(T(21,6,t.trainingMetrics.averageScore,"1.1-1")),p(6),w("",T(27,9,t.trainingMetrics.explorationRate*100,"1.1-1"),"%"),p(6),k(T(33,12,t.trainingMetrics.loss,"1.2-2"))}}function ze(g,e){if(g&1&&(l(0,"div",53)(1,"span",54),d(2,"Decision Mode:"),o(),l(3,"span",55),d(4),L(5,"titlecase"),o()()),g&2){let t=I();p(3),D("exploration",t.visualizationData.explorationVsExploitation==="exploration")("exploitation",t.visualizationData.explorationVsExploitation==="exploitation"),p(),w(" ",ae(5,5,t.visualizationData.explorationVsExploitation)," ")}}function Ne(g,e){if(g&1&&(l(0,"div",61)(1,"div",62),d(2),o(),l(3,"div",63),V(4,"div",64),o(),l(5,"div",65),d(6),L(7,"number"),o()()),g&2){let t=e.$implicit,i=e.index;p(2),k(G(9,Ie)[i]),p(2),ee("width",t*100,"%")("background-color",G(10,Pe)[i]),p(2),w("",T(7,6,t*100,"1.0-0"),"%")}}function De(g,e){if(g&1&&(l(0,"div",70)(1,"span",71),d(2),o(),l(3,"span",72),d(4),L(5,"number"),o()()),g&2){let t=e.$implicit,i=e.index,n=I(3);p(2),k(G(7,ke)[i]),p(),D("best",t===n.getMaxQValue()),p(),w(" ",T(5,4,t,"1.2-2")," ")}}function Ve(g,e){if(g&1&&(l(0,"div",66)(1,"h4",67),d(2,"Q-Values"),o(),l(3,"div",68),S(4,De,6,8,"div",69),o()()),g&2){let t=I(2);p(4),_("ngForOf",t.visualizationData.qValues)}}function Ge(g,e){if(g&1&&(l(0,"div",56)(1,"h3",57),d(2,"Action Preferences"),o(),l(3,"div",58),S(4,Ne,8,11,"div",59),o(),S(5,Ve,5,1,"div",60),o()),g&2){let t=I();p(4),_("ngForOf",t.visualizationData.actionProbabilities),p(),_("ngIf",t.visualizationData)}}var ve=class g{constructor(e,t,i){this.gameService=e;this.aiAgent=t;this.router=i}gameCanvas;networkCanvas;ctx;networkCtx;CELL_SIZE=16;GAME_WIDTH=20*this.CELL_SIZE;GAME_HEIGHT=30*this.CELL_SIZE;destroyed$=new X;gameState=null;trainingMetrics=null;visualizationData=null;currentTheme;isTraining=!1;trainingSpeed=1;autoRestartEnabled=!0;gameLoopInterval;previousGameState=null;ngOnInit(){this.setupCanvases(),this.subscribeToServices(),this.aiAgent.setMode("training")}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this.stopTraining()}setupCanvases(){let e=this.gameCanvas.nativeElement;e.width=this.GAME_WIDTH,e.height=this.GAME_HEIGHT,this.ctx=e.getContext("2d");let t=this.networkCanvas.nativeElement;t.width=400,t.height=300,this.networkCtx=t.getContext("2d")}subscribeToServices(){this.gameService.gameState$.pipe(O(this.destroyed$)).subscribe(e=>{e&&this.handleGameStateUpdate(e)}),this.gameService.currentTheme$.pipe(O(this.destroyed$)).subscribe(e=>{this.currentTheme=e}),this.aiAgent.trainingMetrics$.pipe(O(this.destroyed$)).subscribe(e=>{this.trainingMetrics=e}),this.aiAgent.visualizationData$.pipe(O(this.destroyed$)).subscribe(e=>{this.visualizationData=e,this.renderNetworkVisualization()}),this.gameService.gameOver$.pipe(O(this.destroyed$)).subscribe(()=>{this.isTraining&&this.autoRestartEnabled&&setTimeout(()=>this.restartGame(),1e3)}),this.gameService.levelCompleted$.pipe(O(this.destroyed$)).subscribe(()=>{this.isTraining&&this.autoRestartEnabled&&setTimeout(()=>this.restartGame(),1e3)})}handleGameStateUpdate(e){this.gameState=e,this.isTraining&&!e.gameOver&&!e.paused&&setTimeout(()=>{this.processAITurn(e)},0),this.renderGame()}processAITurn(e){if(!this.isTraining||e.gameOver||e.paused)return;let t=this.aiAgent.getAction(e);if(this.previousGameState){let n=this.aiAgent.calculateReward(this.previousGameState,e,t.direction);this.aiAgent.learn(e,n,e.gameOver)}this.previousGameState=JSON.parse(JSON.stringify(e));let i=this.convertAIActionToDirection(t.direction);this.simulateKeyPress(i)}convertAIActionToDirection(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;default:return 4}}simulateKeyPress(e){let t="";switch(e){case 0:t="ArrowUp";break;case 1:t="ArrowRight";break;case 2:t="ArrowDown";break;case 3:t="ArrowLeft";break;default:return}let i=new KeyboardEvent("keydown",{key:t});this.gameService.handleKeyPress(i)}startTraining(){this.isTraining=!0,this.aiAgent.setMode("training"),this.gameService.startGame(1),this.startGameLoop()}stopTraining(){this.isTraining=!1,this.aiAgent.setMode("inference"),this.stopGameLoop()}pauseTraining(){this.isTraining&&this.gameService.pauseGame()}restartGame(){this.aiAgent.reset(),this.previousGameState=null,this.gameService.startGame(1)}setTrainingSpeed(e){this.trainingSpeed=e,this.isTraining&&(this.stopGameLoop(),this.startGameLoop())}toggleAutoRestart(){this.autoRestartEnabled=!this.autoRestartEnabled}saveModel(){let e=this.aiAgent.saveModel(),t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=`pacman-ai-model-${Date.now()}.json`,n.click(),URL.revokeObjectURL(i)}loadModel(e){let t=e.target.files[0];if(t){let i=new FileReader;i.onload=n=>{let a=n.target?.result;this.aiAgent.loadModel(a)},i.readAsText(t)}}goToMainMenu(){this.stopTraining(),this.router.navigate(["/menu"])}startGameLoop(){this.stopGameLoop();let e=Math.max(50,200/this.trainingSpeed);this.gameLoopInterval=setInterval(()=>{},e)}stopGameLoop(){this.gameLoopInterval&&(clearInterval(this.gameLoopInterval),this.gameLoopInterval=null)}renderGame(){!this.gameState||!this.ctx||(this.ctx.fillStyle=this.currentTheme.backgroundColor,this.ctx.fillRect(0,0,this.GAME_WIDTH,this.GAME_HEIGHT),this.drawMaze(),this.drawPlayer(),this.drawGhosts(),this.drawAIOverlay())}drawMaze(){if(!this.gameState)return;let e=this.gameState.level.grid;for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++){let n=e[t][i],a=i*this.CELL_SIZE,r=t*this.CELL_SIZE;switch(n){case 1:this.ctx.fillStyle=this.currentTheme.wallColor,this.ctx.fillRect(a,r,this.CELL_SIZE,this.CELL_SIZE);break;case 2:this.ctx.fillStyle=this.currentTheme.dotColor,this.ctx.beginPath(),this.ctx.arc(a+this.CELL_SIZE/2,r+this.CELL_SIZE/2,this.CELL_SIZE/8,0,Math.PI*2),this.ctx.fill();break;case 3:this.ctx.fillStyle=this.currentTheme.powerPelletColor,this.ctx.beginPath(),this.ctx.arc(a+this.CELL_SIZE/2,r+this.CELL_SIZE/2,this.CELL_SIZE/4,0,Math.PI*2),this.ctx.fill();break}}}drawPlayer(){if(!this.gameState)return;let e=this.gameState.player,t=e.position.x*this.CELL_SIZE+this.CELL_SIZE/2,i=e.position.y*this.CELL_SIZE+this.CELL_SIZE/2,n=this.CELL_SIZE/2.5;this.ctx.fillStyle=this.currentTheme.playerColor,this.ctx.beginPath(),this.ctx.arc(t,i,n,0,Math.PI*2),this.ctx.fill()}drawGhosts(){this.gameState&&this.gameState.ghosts.forEach(e=>{let t=e.position.x*this.CELL_SIZE+this.CELL_SIZE/2,i=e.position.y*this.CELL_SIZE+this.CELL_SIZE/2,n=this.CELL_SIZE/2.5,a;e.state===1?a=this.currentTheme.frightenedGhostColor:a=this.currentTheme.ghostColors[e.type],this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(t,i,n,0,Math.PI*2),this.ctx.fill()})}drawAIOverlay(){if(!this.visualizationData||!this.gameState)return;let e=this.gameState.player,t=e.position.x*this.CELL_SIZE,i=e.position.y*this.CELL_SIZE;[{dx:0,dy:-1,angle:-Math.PI/2},{dx:1,dy:0,angle:0},{dx:0,dy:1,angle:Math.PI/2},{dx:-1,dy:0,angle:Math.PI}].forEach((a,r)=>{let c=this.visualizationData.qValues[r],s=this.visualizationData.actionProbabilities[r],h=Math.max(...this.visualizationData.qValues),x=Math.min(...this.visualizationData.qValues),m=h!==x?(c-x)/(h-x):.5,u=.3+m*.7,f=10+m*15;this.ctx.strokeStyle=`rgba(255, 255, 0, ${u})`,this.ctx.lineWidth=2+s*3;let v=t+this.CELL_SIZE/2,b=i+this.CELL_SIZE/2,M=v+a.dx*f,P=b+a.dy*f;this.ctx.beginPath(),this.ctx.moveTo(v,b),this.ctx.lineTo(M,P),this.ctx.stroke();let F=5;this.ctx.beginPath(),this.ctx.moveTo(M,P),this.ctx.lineTo(M-F*Math.cos(a.angle-Math.PI/6),P-F*Math.sin(a.angle-Math.PI/6)),this.ctx.moveTo(M,P),this.ctx.lineTo(M-F*Math.cos(a.angle+Math.PI/6),P-F*Math.sin(a.angle+Math.PI/6)),this.ctx.stroke()})}renderNetworkVisualization(){if(!this.visualizationData||!this.networkCtx)return;let e=this.networkCanvas.nativeElement;this.networkCtx.clearRect(0,0,e.width,e.height);let t=80,i=10,n=100,a=20,r=e.height-20,c=this.visualizationData.qValues,s=Math.max(...c),h=Math.min(...c),x=s-h||1,m=["UP","RIGHT","DOWN","LEFT"],u=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4"];c.forEach((f,v)=>{let b=(f-h)/x*n,M=a+v*(t+i),P=r-b;this.networkCtx.fillStyle=u[v],this.networkCtx.fillRect(M,P,t,b),this.networkCtx.fillStyle="#ffffff",this.networkCtx.font="12px Arial",this.networkCtx.textAlign="center",this.networkCtx.fillText(f.toFixed(2),M+t/2,P-5),this.networkCtx.fillText(m[v],M+t/2,r+15)}),this.networkCtx.fillStyle=this.visualizationData.explorationVsExploitation==="exploration"?"#ff9999":"#99ff99",this.networkCtx.font="14px Arial",this.networkCtx.textAlign="left",this.networkCtx.fillText(`Mode: ${this.visualizationData.explorationVsExploitation}`,20,30),this.networkCtx.fillStyle="#ffffff",this.networkCtx.fillText(`State Value: ${this.visualizationData.stateValue.toFixed(2)}`,20,50)}getMaxQValue(){return this.visualizationData?.qValues?Math.max(...this.visualizationData.qValues):0}static \u0275fac=function(t){return new(t||g)(j(ge),j(Z),j(de))};static \u0275cmp=K({type:g,selectors:[["app-ai-learning"]],viewQuery:function(t,i){if(t&1&&(q(Se,7),q(Ee,7)),t&2){let n;Q(n=B())&&(i.gameCanvas=n.first),Q(n=B())&&(i.networkCanvas=n.first)}},decls:73,vars:16,consts:[["gameCanvas",""],["networkCanvas",""],[1,"ai-learning-container"],[1,"ai-header"],[1,"arcade-font","neon-text"],[1,"ai-status"],[1,"status-indicator"],[1,"ai-content"],[1,"game-section"],[1,"game-header"],[1,"section-title"],["class","game-info",4,"ngIf"],[1,"game-canvas-container"],[1,"ai-game-canvas"],["class","game-overlay",4,"ngIf"],[1,"controls-section"],[1,"control-group"],[1,"control-title"],[1,"button-grid"],[1,"control-btn","start-btn",3,"click","disabled"],[1,"control-btn","stop-btn",3,"click","disabled"],[1,"control-btn","pause-btn",3,"click","disabled"],[1,"control-btn","restart-btn",3,"click"],[1,"speed-controls"],["class","speed-btn",3,"active","click",4,"ngFor","ngForOf"],[1,"checkbox-label"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"checkmark"],[1,"model-controls"],[1,"control-btn","save-btn",3,"click"],[1,"load-btn"],["type","file","accept",".json",2,"display","none",3,"change"],[1,"metrics-section"],["class","metrics-grid",4,"ngIf"],[1,"visualization-section"],[1,"viz-header"],["class","ai-mode",4,"ngIf"],[1,"viz-content"],[1,"network-canvas-container"],[1,"network-canvas"],["class","action-analysis",4,"ngIf"],[1,"ai-footer"],[1,"game-btn","menu-btn",3,"click"],[1,"info-text"],[1,"game-info"],[1,"game-overlay"],[1,"overlay-text"],[1,"speed-btn",3,"click"],[1,"metrics-grid"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],[1,"metric-value","neon-text"],[1,"ai-mode"],[1,"mode-label"],[1,"mode-value"],[1,"action-analysis"],[1,"analysis-title"],[1,"action-bars"],["class","action-bar",4,"ngFor","ngForOf"],["class","q-values",4,"ngIf"],[1,"action-bar"],[1,"action-name"],[1,"bar-container"],[1,"bar-fill"],[1,"action-percentage"],[1,"q-values"],[1,"q-title"],[1,"q-list"],["class","q-item",4,"ngFor","ngForOf"],[1,"q-item"],[1,"q-action"],[1,"q-value"]],template:function(t,i){if(t&1){let n=$();l(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"AI Learning Mode"),o(),l(4,"div",5)(5,"span",6),d(6),o()()(),l(7,"div",7)(8,"div",8)(9,"div",9)(10,"h2",10),d(11,"Game View"),o(),S(12,Oe,7,3,"div",11),o(),l(13,"div",12),V(14,"canvas",13,0),S(16,Le,3,0,"div",14),o()(),l(17,"div",15)(18,"div",16)(19,"h3",17),d(20,"Training Controls"),o(),l(21,"div",18)(22,"button",19),E("click",function(){return y(n),C(i.startTraining())}),d(23," Start Training "),o(),l(24,"button",20),E("click",function(){return y(n),C(i.stopTraining())}),d(25," Stop Training "),o(),l(26,"button",21),E("click",function(){return y(n),C(i.pauseTraining())}),d(27," Pause "),o(),l(28,"button",22),E("click",function(){return y(n),C(i.restartGame())}),d(29," Restart Game "),o()()(),l(30,"div",16)(31,"h3",17),d(32,"Speed Control"),o(),l(33,"div",23),S(34,Ae,2,3,"button",24),o()(),l(35,"div",16)(36,"h3",17),d(37,"Options"),o(),l(38,"label",25)(39,"input",26),ne("ngModelChange",function(r){return y(n),ie(i.autoRestartEnabled,r)||(i.autoRestartEnabled=r),C(r)}),E("change",function(){return y(n),C(i.toggleAutoRestart())}),o(),V(40,"span",27),d(41," Auto-restart on game over "),o()(),l(42,"div",16)(43,"h3",17),d(44,"Model Management"),o(),l(45,"div",28)(46,"button",29),E("click",function(){return y(n),C(i.saveModel())}),d(47," Save Model "),o(),l(48,"label",30),d(49," Load Model "),l(50,"input",31),E("change",function(r){return y(n),C(i.loadModel(r))}),o()()()()(),l(51,"div",32)(52,"h2",10),d(53,"Training Metrics"),o(),S(54,Te,34,15,"div",33),o()(),l(55,"div",34)(56,"div",35)(57,"h2",10),d(58,"Neural Network Visualization"),o(),S(59,ze,6,7,"div",36),o(),l(60,"div",37)(61,"div",38),V(62,"canvas",39,1),o(),S(64,Ge,6,2,"div",40),o()(),l(65,"div",41)(66,"button",42),E("click",function(){return y(n),C(i.goToMainMenu())}),d(67," Back to Menu "),o(),l(68,"div",43)(69,"p"),d(70,"Watch the AI learn to play Pacman using Deep Q-Learning (DQN)"),o(),l(71,"p"),d(72,"Yellow arrows show the AI's action preferences in real-time"),o()()()()}t&2&&(p(5),D("training",i.isTraining)("stopped",!i.isTraining),p(),w(" ",i.isTraining?"TRAINING":"STOPPED"," "),p(6),_("ngIf",i.gameState),p(4),_("ngIf",!i.isTraining),p(6),_("disabled",i.isTraining),p(2),_("disabled",!i.isTraining),p(2),_("disabled",!i.isTraining),p(8),_("ngForOf",G(15,we)),p(5),te("ngModel",i.autoRestartEnabled),p(15),_("ngIf",i.trainingMetrics),p(5),_("ngIf",i.visualizationData),p(5),_("ngIf",i.visualizationData))},dependencies:[ce,re,oe,le,se,me,fe,he,pe,ue],styles:['.ai-learning-container[_ngcontent-%COMP%]{min-height:100vh;height:auto;background:linear-gradient(135deg,#0a0a0a,#1a1a2e,#16213e);color:#fff;padding:1rem;font-family:"Press Start 2P",cursive;overflow-y:auto;overflow-x:hidden}.ai-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding:1rem;background:#2121ff1a;border:2px solid #2121ff;border-radius:.5rem}.ai-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;margin:0}.ai-status[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:.25rem;font-size:.75rem;font-weight:700;text-transform:uppercase;animation:_ngcontent-%COMP%_pulse 2s infinite}.status-indicator.training[_ngcontent-%COMP%]{background-color:#10b981;color:#fff;box-shadow:0 0 10px #10b981}.status-indicator.stopped[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff;box-shadow:0 0 10px #ef4444}.ai-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 300px 1fr;gap:2rem;margin-bottom:2rem;min-height:0}.game-section[_ngcontent-%COMP%]{background:#000c;border:2px solid #2121ff;border-radius:.5rem;padding:1rem;overflow:hidden;max-height:70vh;display:flex;flex-direction:column}.game-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;color:#ff0;margin:0}.game-info[_ngcontent-%COMP%]{display:flex;gap:1rem;font-size:.75rem;color:#fff}.game-canvas-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;flex-shrink:0}.ai-game-canvas[_ngcontent-%COMP%]{border:2px solid #2121ff;border-radius:.25rem;background-color:#000;box-shadow:0 0 10px #2121ff;image-rendering:pixelated}.game-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;border-radius:.25rem}.overlay-text[_ngcontent-%COMP%]{color:#ff0;font-size:1rem;text-align:center}.controls-section[_ngcontent-%COMP%]{background:#000c;border:2px solid #2121ff;border-radius:.5rem;padding:1rem;display:flex;flex-direction:column;gap:1.5rem;max-height:70vh;overflow-y:auto}.control-group[_ngcontent-%COMP%]{border-bottom:1px solid #333;padding-bottom:1rem}.control-group[_ngcontent-%COMP%]:last-child{border-bottom:none;padding-bottom:0}.control-title[_ngcontent-%COMP%]{font-size:.75rem;color:#ff0;margin:0 0 .75rem}.button-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}.control-btn[_ngcontent-%COMP%]{padding:.5rem;font-size:.625rem;font-family:"Press Start 2P",cursive;border:1px solid #2121ff;border-radius:.25rem;background:#2121ff33;color:#fff;cursor:pointer;transition:all .3s ease}.control-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2121ff66;box-shadow:0 0 5px #2121ff}.control-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.start-btn[_ngcontent-%COMP%]:not(:disabled){background:#10b98133;border-color:#10b981}.start-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#10b98166;box-shadow:0 0 5px #10b981}.stop-btn[_ngcontent-%COMP%]:not(:disabled){background:#ef444433;border-color:#ef4444}.stop-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#ef444466;box-shadow:0 0 5px #ef4444}.pause-btn[_ngcontent-%COMP%]:not(:disabled){background:#fbbf2433;border-color:#fbbf24}.pause-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#fbbf2466;box-shadow:0 0 5px #fbbf24}.speed-controls[_ngcontent-%COMP%]{display:flex;gap:.25rem}.speed-btn[_ngcontent-%COMP%]{flex:1;padding:.5rem;font-size:.625rem;font-family:"Press Start 2P",cursive;border:1px solid #2121ff;border-radius:.25rem;background:#2121ff33;color:#fff;cursor:pointer;transition:all .3s ease}.speed-btn.active[_ngcontent-%COMP%]{background:#ffff004d;border-color:#ff0;color:#ff0;box-shadow:0 0 5px #ff0}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.625rem;cursor:pointer}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin:0;width:1rem;height:1rem}.model-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.load-btn[_ngcontent-%COMP%]{padding:.5rem;font-size:.625rem;font-family:"Press Start 2P",cursive;border:1px solid #2121ff;border-radius:.25rem;background:#2121ff33;color:#fff;cursor:pointer;transition:all .3s ease;text-align:center;display:block}.load-btn[_ngcontent-%COMP%]:hover{background:#2121ff66;box-shadow:0 0 5px #2121ff}.metrics-section[_ngcontent-%COMP%]{background:#000c;border:2px solid #2121ff;border-radius:.5rem;padding:1rem;max-height:70vh;overflow-y:auto}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:.75rem}.metric-card[_ngcontent-%COMP%]{background:#2121ff1a;border:1px solid #2121ff;border-radius:.25rem;padding:.75rem;text-align:center}.metric-label[_ngcontent-%COMP%]{font-size:.625rem;color:#9ca3af;margin-bottom:.25rem}.metric-value[_ngcontent-%COMP%]{font-size:1rem;color:#fff;font-weight:700}.metric-value.neon-text[_ngcontent-%COMP%]{color:#ff0;text-shadow:0 0 5px #ffff00}.visualization-section[_ngcontent-%COMP%]{grid-column:1 / -1;background:#000c;border:2px solid #2121ff;border-radius:.5rem;padding:1rem;margin-top:2rem;overflow:hidden}.viz-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.ai-mode[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.mode-label[_ngcontent-%COMP%]{font-size:.75rem;color:#9ca3af}.mode-value[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .5rem;border-radius:.25rem}.mode-value.exploration[_ngcontent-%COMP%]{background:#ff99994d;color:#f99;border:1px solid #ff9999}.mode-value.exploitation[_ngcontent-%COMP%]{background:#99ff994d;color:#9f9;border:1px solid #99ff99}.viz-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;max-height:60vh;overflow:hidden}.network-canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;overflow:hidden}.network-canvas[_ngcontent-%COMP%]{border:1px solid #2121ff;border-radius:.25rem;background-color:#000}.action-analysis[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;overflow-y:auto;max-height:60vh;padding-right:.5rem}.analysis-title[_ngcontent-%COMP%]{font-size:.875rem;color:#ff0;margin:0}.action-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.action-bar[_ngcontent-%COMP%]{display:grid;grid-template-columns:60px 1fr 40px;align-items:center;gap:.5rem}.action-name[_ngcontent-%COMP%]{font-size:.625rem;color:#fff}.bar-container[_ngcontent-%COMP%]{height:1.5rem;background:#ffffff1a;border-radius:.75rem;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:.75rem;transition:width .3s ease}.action-percentage[_ngcontent-%COMP%]{font-size:.625rem;color:#fff;text-align:right}.q-values[_ngcontent-%COMP%]{border-top:1px solid #333;padding-top:1rem}.q-title[_ngcontent-%COMP%]{font-size:.75rem;color:#ff0;margin:0 0 .5rem}.q-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.q-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.25rem .5rem;background:#ffffff0d;border-radius:.25rem}.q-action[_ngcontent-%COMP%]{font-size:1rem;width:2rem;text-align:center}.q-value[_ngcontent-%COMP%]{font-size:.625rem;color:#fff}.q-value.best[_ngcontent-%COMP%]{color:#ff0;font-weight:700;text-shadow:0 0 3px #ffff00}.ai-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#2121ff1a;border:2px solid #2121ff;border-radius:.5rem}.menu-btn[_ngcontent-%COMP%]{background-color:#4b5563;padding:.75rem 1.5rem;font-size:.75rem}.menu-btn[_ngcontent-%COMP%]:hover{background-color:#6b7280}.info-text[_ngcontent-%COMP%]{text-align:right;font-size:.625rem;color:#9ca3af;line-height:1.4}@media (max-width: 1200px){.ai-content[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.viz-content[_ngcontent-%COMP%]{grid-template-columns:1fr;max-height:none}.game-section[_ngcontent-%COMP%], .controls-section[_ngcontent-%COMP%], .metrics-section[_ngcontent-%COMP%], .action-analysis[_ngcontent-%COMP%]{max-height:none}}@media (max-width: 768px){.ai-header[_ngcontent-%COMP%], .ai-footer[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.button-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.ai-content[_ngcontent-%COMP%]{padding:.5rem}.visualization-section[_ngcontent-%COMP%]{margin-top:1rem}}body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{overflow-y:auto!important;height:auto!important}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}@keyframes _ngcontent-%COMP%_glow{0%,to{box-shadow:0 0 5px #2121ff}50%{box-shadow:0 0 20px #2121ff,0 0 30px #2121ff}}']})};export{ve as AILearningComponent};
